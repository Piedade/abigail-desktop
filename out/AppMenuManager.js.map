{"version":3,"file":"AppMenuManager.js","sourceRoot":"","sources":["../src/AppMenuManager.ts"],"names":[],"mappings":"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","sourcesContent":["import {app, Menu, shell, BrowserWindow, ipcMain} from \"electron\";\nimport {WINDOW_NAVIGATED} from \"./WindowManager\";\nimport {AppSignal} from \"./electronEventSignals\";\nimport MenuItemOptions = Electron.MenuItemOptions\nimport WebContents = Electron.WebContents\n\nexport default function setMenu(homeUrl: string) {\n  const windowsMenu: MenuItemOptions = {\n    label: 'Window',\n    role: 'window',\n    submenu: [\n      {\n        label: 'Minimize',\n        accelerator: 'CmdOrCtrl+M',\n        role: 'minimize'\n      },\n      {\n        label: 'Close',\n        accelerator: 'CmdOrCtrl+W',\n        role: 'close'\n      },\n    ]\n  }\n\n  const name = app.getName()\n  const template: Array<MenuItemOptions> = [\n    {\n      label: 'Edit',\n      submenu: [\n        {\n          label: 'Undo',\n          accelerator: 'CmdOrCtrl+Z',\n          role: 'undo'\n        },\n        {\n          label: 'Redo',\n          accelerator: 'Shift+CmdOrCtrl+Z',\n          role: 'redo'\n        },\n        {\n          type: 'separator'\n        },\n        {\n          label: 'Cut',\n          accelerator: 'CmdOrCtrl+X',\n          role: 'cut'\n        },\n        {\n          label: 'Copy',\n          accelerator: 'CmdOrCtrl+C',\n          role: 'copy'\n        },\n        {\n          label: 'Paste',\n          accelerator: 'CmdOrCtrl+V',\n          role: 'paste'\n        },\n        {\n          label: 'Select All',\n          accelerator: 'CmdOrCtrl+A',\n          role: 'selectall'\n        },\n      ]\n    },\n    {\n      label: 'View',\n      submenu: [\n        {\n          label: 'Reload',\n          accelerator: 'CmdOrCtrl+R',\n          click: (item: any, focusedWindow: any) => {\n            if (focusedWindow != null)\n              focusedWindow.reload()\n          }\n        },\n        {\n          label: 'Enter Full Screen',\n          accelerator: process.platform == 'darwin' ? 'Ctrl+Command+F' : 'F11',\n          click: (item: any, focusedWindow: any) => {\n            if (focusedWindow)\n              focusedWindow.setFullScreen(!focusedWindow.isFullScreen());\n          }\n        },\n      ]\n    },\n    {\n      label: 'History',\n      submenu: [\n        {\n          label: 'Back',\n          accelerator: 'CmdOrCtrl+[',\n          enabled: false,\n          click: function () {\n            historyGo(true)\n          }\n        },\n        {\n          label: 'Forward',\n          enabled: false,\n          accelerator: 'CmdOrCtrl+]',\n          click: function () {\n            historyGo(false)\n          }\n        },\n        {\n          label: 'Home',\n          enabled: false,\n          accelerator: 'Shift+CmdOrCtrl+H',\n          click: function () {\n            const webContents = getFocusedWebContents()\n            if (webContents != null) {\n              webContents.loadURL(homeUrl)\n            }\n          }\n        },\n      ]\n    },\n    windowsMenu,\n    {\n      label: 'Help',\n      role: 'help',\n      submenu: [\n        {\n          label: name + ' Help',\n          click: openExternalHandler('https://cad.onshape.com/help/')\n        },\n        {\n          label: name + ' Support',\n          click: openExternalHandler('https://www.onshape.com/support/')\n        },\n        {\n          label: name + ' Forums',\n          click: openExternalHandler('https://forum.onshape.com/')\n        },\n        {\n          label: name + ' Blog',\n          click: openExternalHandler('https://www.onshape.com/cad-blog/')\n        },\n        {\n          type: 'separator'\n        },\n        {\n          label: name + ' Status',\n          click: openExternalHandler('http://status.onshape.com/')\n        },\n      ]\n    },\n  ]\n\n  if (process.platform === 'darwin') {\n    template.unshift({\n      label: name,\n      submenu: [\n        {\n          label: 'About ' + name,\n          role: 'about'\n        },\n        {\n          type: 'separator'\n        },\n        {\n          label: 'Hide ' + name,\n          accelerator: 'Command+H',\n          role: 'hide'\n        },\n        {\n          label: 'Hide Others',\n          accelerator: 'Command+Shift+H',\n          role: 'hideothers'\n        },\n        {\n          label: 'Show All',\n          role: 'unhide'\n        },\n        {\n          type: 'separator'\n        },\n        {\n          label: 'Quit',\n          accelerator: 'Command+Q',\n          click: ()=> {\n            app.quit()\n          }\n        }\n      ]\n    });\n\n    (<Array<MenuItemOptions>>(windowsMenu.submenu)).push(\n      {\n        type: 'separator'\n      },\n      {\n        label: 'Bring All to Front',\n        role: 'front'\n      })\n  }\n\n  const appMenu = Menu.buildFromTemplate(template)\n  const items: any[] = appMenu.items\n  for (const item of items) {\n    if (item.label === \"History\") {\n      const submenu = item.submenu\n      updateHistoryMenuItems(submenu.items, homeUrl)\n      break\n    }\n  }\n  Menu.setApplicationMenu(appMenu)\n}\n\nfunction updateHistoryMenuItems(items: MenuItemOptions[], homeUrl: string) {\n  function updateEnabled(webContents: WebContents) {\n    items[0].enabled = webContents.canGoBack()\n    items[1].enabled = webContents.canGoForward()\n  }\n\n  ipcMain.on(WINDOW_NAVIGATED, <any>((webContents: WebContents, url: string) => {\n      updateEnabled(webContents)\n      items[2].enabled = url.replace(/(\\?.*)|(#.*)/g, \"\") != homeUrl\n    }))\n\n  new AppSignal()\n    .windowBlurred(() => {\n      items[0].enabled = false\n      items[1].enabled = false\n    })\n    .windowFocused((event, window) => {\n      updateEnabled(window.webContents)\n    })\n}\n\nfunction openExternalHandler(url: string) {\n  return shell.openExternal.bind(shell, url)\n}\n\nfunction getFocusedWebContents(): WebContents {\n  const focusedWindow = BrowserWindow.getFocusedWindow()\n  return focusedWindow == null ? null : focusedWindow.webContents\n}\n\nfunction historyGo(back: boolean) {\n  const webContents = getFocusedWebContents()\n  if (webContents != null) {\n    if (back) {\n      webContents.goBack()\n    }\n    else {\n      webContents.goForward()\n    }\n  }\n}"]}